<!doctype html>
<html lang="fr" data-theme="auto">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <title>FABLE Collector — Statut & fenêtres</title>
  <style>
    /*
      ⚓ Design system minimal, AA/AAA-friendly, sans dépendances.
      - Palette via variables CSS (clair/sombre)
      - Échelle typo fluide (clamp)
      - Espacements, rayons, ombres
      - Badges/pills (solides + soft) avec icônes
      - Tableau de fraîcheur responsive, lisible mobile
      - Toggle mode sombre mémorisé (localStorage)
    */

    :root {
      /* Couleurs de base (clair) */
      --bg: #f7fafc;               /* gris très clair, non pur blanc pour moins d’éblouissement */
      --bg-elev: #ffffff;          /* surfaces (cards) */
      --text: #0b1320;             /* bleu nuit quasi-noir */
      --muted: #5b6473;            /* texte secondaire */
      --border: #d6dde6;

      /* Marins / météo */
      --primary: #0a5fb4;          /* bleu cap (actions) */
      --primary-contrast: #ffffff;
      --info: #1e88e5;             /* info (bleu) */
      --success: #1b7f4b;          /* vert profond (AAA sur blanc avec texte clair) */
      --warning: #b26a00;          /* ambré foncé */
      --danger: #9b1c1c;           /* rouge bourgogne */

      /* Variants “soft” (fonds pâles + texte foncé) */
      --success-soft-bg: #d1fae5;  /* vert 100-200 */
      --success-soft-fg: #065f46;
      --warning-soft-bg: #fff4db;
      --warning-soft-fg: #7a4a00;
      --danger-soft-bg: #fde2e2;
      --danger-soft-fg: #7a1111;
      --info-soft-bg: #e3f2fd;
      --info-soft-fg: #0b4f8a;

      /* Échelle */
      --radius: 16px;              /* 2xl arrondi */
      --radius-sm: 10px;
      --shadow-1: 0 1px 2px rgba(0,0,0,.04), 0 8px 24px rgba(0,0,0,.06);
      --shadow-2: 0 1px 2px rgba(0,0,0,.06), 0 12px 40px rgba(0,0,0,.10);

      /* Typo (système par défaut) */
      --font: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      --size-100: clamp(0.80rem, 0.74rem + 0.2vw, 0.90rem);
      --size-200: clamp(0.95rem, 0.90rem + 0.3vw, 1.00rem);
      --size-300: clamp(1.05rem, 1.00rem + 0.4vw, 1.15rem);
      --size-400: clamp(1.25rem, 1.18rem + 0.6vw, 1.45rem);
      --size-500: clamp(1.50rem, 1.38rem + 0.8vw, 1.80rem);
      --size-600: clamp(1.85rem, 1.70rem + 1.0vw, 2.20rem);

      /* Espacements */
      --space-1: .25rem;
      --space-2: .5rem;
      --space-3: .75rem;
      --space-4: 1rem;
      --space-5: 1.5rem;
      --space-6: 2rem;
      --space-7: 3rem;
    }

    /* Thème sombre */
    html[data-theme="dark"] {
      --bg: #0c1218;
      --bg-elev: #0f161d;
      --text: #eaf2ff;
      --muted: #a7b3c7;
      --border: #263140;

      --primary: #5ab0ff;          /* bleu plus clair pour contraste sur sombre */
      --primary-contrast: #081018;
      --info: #7ec2ff;
      --success: #79d2a5;
      --warning: #ffd27a;
      --danger: #ff8f8f;

      --success-soft-bg: #0f2a21;
      --success-soft-fg: #9ae6b4;
      --warning-soft-bg: #2a210f;
      --warning-soft-fg: #ffd27a;
      --danger-soft-bg: #2a1414;
      --danger-soft-fg: #ffb3b3;
      --info-soft-bg: #102433;
      --info-soft-fg: #b8e0ff;

      --shadow-1: 0 1px 2px rgba(0,0,0,.4), 0 8px 24px rgba(0,0,0,.35);
      --shadow-2: 0 1px 2px rgba(0,0,0,.45), 0 12px 40px rgba(0,0,0,.4);
    }

    /* Base */
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 0; font-family: var(--font);
      font-size: var(--size-200); line-height: 1.45;
      color: var(--text); background: radial-gradient(1200px 800px at 10% -10%, rgba(10,95,180,.08), transparent 60%), var(--bg);
    }
    .container { max-width: 1000px; margin: 0 auto; padding: var(--space-6) var(--space-4) var(--space-7); }

    header.nav {
      display: flex; align-items: center; justify-content: space-between;
      gap: var(--space-4); margin-bottom: var(--space-6);
    }
    .brand { display:flex; align-items:center; gap: var(--space-3); }
    .brand .logo { width: 40px; height: 40px; border-radius: 12px; background: linear-gradient(135deg, var(--primary), #0b91ff); box-shadow: var(--shadow-1); }
    .brand h1 { font-size: var(--size-500); margin: 0; letter-spacing: .2px; }
    .brand .sub { color: var(--muted); font-size: var(--size-100); margin-top: 2px; }

    /* Boutons */
    .btn {
      appearance: none; border: 1px solid var(--border); background: var(--bg-elev);
      color: var(--text); border-radius: 999px; padding: .55rem .9rem; font-weight: 600;
      box-shadow: var(--shadow-1); cursor: pointer; display: inline-flex; align-items: center; gap: .5rem;
    }
    .btn:hover { transform: translateY(-1px); }
    .btn:active { transform: translateY(0); }
    .btn-primary { background: var(--primary); border-color: transparent; color: var(--primary-contrast); }

    /* Section blocks */
    .card { background: var(--bg-elev); border: 1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow-1); padding: var(--space-5); }
    .stack { display: grid; gap: var(--space-4); }

    h2 { font-size: var(--size-400); margin: 0 0 var(--space-4); }
    p { margin: 0 0 var(--space-4); color: var(--text); }
    .muted { color: var(--muted); }

    /* Pills */
    .pills { display: flex; flex-wrap: wrap; gap: .5rem; }
    .pill { display: inline-flex; align-items: center; gap: .5rem; font-weight: 700; letter-spacing: .2px;
            padding: .35rem .65rem; border-radius: 999px; border: 1px solid transparent; white-space: nowrap; }
    .pill svg { width: 1rem; height: 1rem; }

    /* Solides (AAA visé) */
    .pill--success { background: var(--success); color: #ffffff; }
    .pill--warning { background: var(--warning); color: #1f1400; }
    .pill--danger  { background: var(--danger);  color: #ffffff; }
    .pill--info    { background: var(--info);    color: #071421; }

    /* Soft (texte foncé + fond pâle) */
    .pill--success-soft { background: var(--success-soft-bg); color: var(--success-soft-fg); border-color: color-mix(in oklab, var(--success-soft-fg), #000 10%); }
    .pill--warning-soft { background: var(--warning-soft-bg); color: var(--warning-soft-fg); border-color: color-mix(in oklab, var(--warning-soft-fg), #000 10%); }
    .pill--danger-soft  { background: var(--danger-soft-bg);  color: var(--danger-soft-fg);  border-color: color-mix(in oklab, var(--danger-soft-fg), #000 10%); }
    .pill--info-soft    { background: var(--info-soft-bg);    color: var(--info-soft-fg);    border-color: color-mix(in oklab, var(--info-soft-fg), #000 10%); }

    /* Tableau de fraîcheur */
    .table-wrap { overflow: auto; border-radius: var(--radius); border: 1px solid var(--border); background: var(--bg-elev); box-shadow: var(--shadow-1); }
    table { width: 100%; border-collapse: collapse; min-width: 720px; }
    thead th { text-align: left; font-size: var(--size-100); text-transform: uppercase; letter-spacing: .08em; color: var(--muted); background: linear-gradient(180deg, rgba(0,0,0,.02), transparent); }
    th, td { padding: .8rem 1rem; border-bottom: 1px solid var(--border); }
    tbody tr:hover { background: color-mix(in oklab, var(--bg-elev), #000 4%); }
    td .mono { font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

    /* Version “cartes” pour mobile étroit (option) */
    @media (max-width: 560px) {
      .table-cards { display: grid; gap: var(--space-3); }
      .table-cards .row { border: 1px solid var(--border); border-radius: var(--radius-sm); padding: var(--space-4); background: var(--bg-elev); box-shadow: var(--shadow-1); }
      .table-cards .row .top { display: flex; align-items: center; justify-content: space-between; gap: .5rem; margin-bottom: .5rem; }
      .table-cards .grid { display: grid; grid-template-columns: 1fr 1fr; gap: .5rem .75rem; }
      .table-cards .label { color: var(--muted); font-size: var(--size-100); }
    }

    /* Légende & aides */
    .legend { display: flex; gap: .75rem; flex-wrap: wrap; align-items: center; }
    .legend .item { display: inline-flex; align-items: center; gap: .5rem; color: var(--muted); }

    footer { margin-top: var(--space-7); color: var(--muted); font-size: var(--size-100); text-align: center; }
  </style>
</head>
<body>
  <div class="container">
    <header class="nav" role="banner">
      <div class="brand" aria-label="FABLE Collector">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>FABLE&nbsp;Collector</h1>
          <div class="sub">Suivi des fenêtres · Gammarth, Sidi Bou Saïd, Ghar el Melh, Ras Fartass, El Haouaria</div>
        </div>
      </div>
      <div class="actions" role="group" aria-label="Actions d’affichage">
        <button class="btn" id="unitToggle" aria-pressed="false" title="Basculer km/h ↔︎ nœuds">km/h · m · s</button>
        <button class="btn" id="themeToggle" aria-pressed="false" title="Basculer clair/sombre">Thème</button>
      </div>
    </header>

    <section class="stack">
      <div class="card">
        <h2>État courant</h2>
        <p class="muted">Dernière génération collector & lecteur · <span class="mono" id="ts">—</span> · Africa/Tunis</p>
        <div class="pills" aria-label="Badges de synthèse">
          <span class="pill pill--success" title="Fenêtre Family disponible" role="status">✔︎ Family GO</span>
          <span class="pill pill--warning" title="Fenêtre Expert-Only" role="status">! Expert-Only</span>
          <span class="pill pill--danger-soft" title="Pas de fenêtre actuelle" role="status">× Aucune fenêtre</span>
          <span class="pill pill--info-soft" title="Confiance des modèles" role="status">Confiance : Moyenne</span>
        </div>
      </div>

      <div class="card">
        <h2>Fichiers & fraîcheur</h2>
        <div class="legend" aria-hidden="true">
          <span class="item"><span class="pill pill--success-soft">OK</span><span class="muted">à l’heure</span></span>
          <span class="item"><span class="pill pill--warning-soft">Lent</span><span class="muted">en retard</span></span>
          <span class="item"><span class="pill pill--danger-soft">HS</span><span class="muted">manquant</span></span>
        </div>

        <!--
          ⚙️ Variante table scrollable (desktop) + cartes (mobile <=560px).
          Branche les données en remplaçant les placeholders ci-dessous à partir de status.json / index.json.
        -->
        <div class="table-wrap" role="region" aria-label="Tableau des fichiers" tabindex="0">
          <table aria-describedby="helpFreshness">
            <thead>
              <tr>
                <th scope="col">Fichier</th>
                <th scope="col">Modifié</th>
                <th scope="col">Taille</th>
                <th scope="col">Statut</th>
              </tr>
            </thead>
            <tbody id="tableBody">
              <!-- Lignes injectées par JS -->
            </tbody>
          </table>
        </div>
        <p id="helpFreshness" class="muted" style="margin-top: .5rem;">Les horodatages sont convertis en heure locale (Africa/Tunis). Les statuts reflètent la fenêtre de fraîcheur ciblée par le healthcheck.</p>

        <!-- Version cartes (option si tu préfères sur mobile) -->
        <div class="table-cards" id="tableCards" hidden>
          <!-- Cartes injectées par JS si jamais on choisit ce mode -->
        </div>
      </div>

      <div class="card">
        <h2>Légende des badges</h2>
        <ul>
          <li><strong>✔︎ Family GO</strong> : toutes les règles Family sont vraies pendant les heures 08:00–21:00.</li>
          <li><strong>Expert-Only</strong> : conditions praticables mais au-delà du confort famille.</li>
          <li><strong>Confiance</strong> : High si spreads vent < 5 km/h et Hs < 0,2 m ; Low si 3‑hourly ou source unique Hs/Tp.</li>
        </ul>
      </div>
    </section>

    <footer>
      <div>© FABLE AI — Rapport météo loisirs & pêche amateur. Respectez les règles locales et votre jauge personnelle.</div>
    </footer>
  </div>

  <script>
    // === Prefs thème (auto/clair/sombre) ===
    const THEME_KEY = 'fable.theme';
    const themeBtn = document.getElementById('themeToggle');
    function applyTheme(mode) {
      // mode: 'light' | 'dark' | 'auto'
      document.documentElement.setAttribute('data-theme', mode === 'auto' ? (matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : mode);
      localStorage.setItem(THEME_KEY, mode);
      themeBtn.setAttribute('aria-pressed', mode === 'dark');
      themeBtn.textContent = 'Thème' + (mode === 'dark' ? ' · sombre' : mode === 'light' ? ' · clair' : ' · auto');
    }
    function cycleTheme() {
      const cur = localStorage.getItem(THEME_KEY) || 'auto';
      const next = cur === 'auto' ? 'dark' : cur === 'dark' ? 'light' : 'auto';
      applyTheme(next);
    }
    themeBtn.addEventListener('click', cycleTheme);
    applyTheme(localStorage.getItem(THEME_KEY) || 'auto');

    // === Unités (placeholder) ===
    const unitBtn = document.getElementById('unitToggle');
    const UNIT_KEY = 'fable.units'; // 'metric' | 'nautical'
    function applyUnits(u){ localStorage.setItem(UNIT_KEY, u); unitBtn.textContent = (u==='nautical'? 'kn · m · s' : 'km/h · m · s'); }
    unitBtn.addEventListener('click', () => {
      const cur = localStorage.getItem(UNIT_KEY) || 'metric';
      applyUnits(cur === 'metric' ? 'nautical' : 'metric');
    });
    applyUnits(localStorage.getItem(UNIT_KEY) || 'metric');

    // === Données de démonstration (remplace par fetch de status.json & index.json) ===
    const demoRows = [
      { name: 'index.json', mtime: '2025-09-14T17:55:00Z', size: 2140, status: 'ok' },
      { name: 'rules.normalized.json', mtime: '2025-09-14T17:55:00Z', size: 3102, status: 'ok' },
      { name: 'gammarth-port.json', mtime: '2025-09-14T17:00:00Z', size: 18240, status: 'ok' },
      { name: 'sidi-bou-said.json', mtime: '2025-09-14T16:00:00Z', size: 17650, status: 'late' },
      { name: 'ghar-el-melh.json', mtime: '2025-09-14T17:00:00Z', size: 17990, status: 'ok' },
      { name: 'ras-fartass.json', mtime: '2025-09-14T12:00:00Z', size: 16011, status: 'late' },
      { name: 'el-haouaria.json', mtime: '2025-09-13T12:00:00Z', size: 0, status: 'down' },
    ];

    function formatSize(bytes){ if(!bytes) return '—'; const units=['o','Ko','Mo','Go']; let i=0; let n=bytes; while(n>=1024 && i<units.length-1){ n/=1024; i++; } return n.toFixed(n<10?1:0)+'\u00A0'+units[i]; }
    function toLocal(ts){ try{ const d=new Date(ts); return d.toLocaleString('fr-FR', { hour12:false, timeZone: 'Africa/Tunis' }); }catch{ return '—'; } }

    function statusPill(s){
      const map = {
        ok:   { cls: 'pill pill--success-soft', label: 'OK' },
        late: { cls: 'pill pill--warning-soft', label: 'Lent' },
        down: { cls: 'pill pill--danger-soft',  label: 'HS' },
      };
      const x = map[s] || map.down;
      return `<span class="${x.cls}">${x.label}</span>`;
    }

    function renderTable(rows){
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = rows.map(r => `
        <tr>
          <th scope="row">${r.name}</th>
          <td class="mono">${toLocal(r.mtime)}</td>
          <td class="mono">${formatSize(r.size)}</td>
          <td>${statusPill(r.status)}</td>
        </tr>
      `).join('');
    }

    // Horodatage haut de page
    const now = new Date();
    document.getElementById('ts').textContent = now.toLocaleString('fr-FR', { hour12:false, timeZone: 'Africa/Tunis' });

    renderTable(demoRows);

    // 🔌 Exemple de branchement réel (décommente et adapte au CORS) :
    // async function loadStatus(){
    //   const [status, index] = await Promise.all([
    //     fetch('./status.json').then(r=>r.json()),
    //     fetch('./index.json').then(r=>r.json()),
    //   ]);
    //   // Mappe ici index.files et status.flags -> rows {name, mtime, size, status}
    //   renderTable(rows);
    // }
    // loadStatus();
  </script>
</body>
</html>
